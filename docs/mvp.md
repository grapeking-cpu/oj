# MVP 迭代计划

## 迭代概览

| 迭代 | 周期 | 目标 | 核心功能 |
|------|------|------|----------|
| MVP v0.1 | 1周 | 核心骨架 | 项目初始化 + DB + 基础 API |
| MVP v0.2 | 1周 | 用户系统 | 注册/登录/JWT/验证码 |
| MVP v0.3 | 1周 | 题库基础 | 题目CRUD + 提交接口 |
| MVP v0.4 | 2周 | 评测核心 | NATS + Worker + Docker 判题 |
| MVP v0.5 | 1周 | 前端基础 | React + 题目列表/详情/提交 |
| MVP v0.6 | 1周 | 比赛基础 | 比赛CRUD + 榜单 |
| MVP v0.7 | 1周 | 实时推送 | WebSocket + 状态推送 |
| MVP v0.8 | 1周 | CF同步 | Codeforces 镜像赛 |
| MVP v1.0 | 1周 | 优化上线 | 性能优化 + 部署 |

---

## MVP v0.1: 核心骨架 (1周)

### 目标
项目初始化，数据库连接，基础框架搭建

### 任务清单
- [ ] 创建 Go 项目结构 (cmd/internal/pkg)
- [ ] 配置 GORM 连接 PostgreSQL
- [ ] 配置 Redis 连接
- [ ] 配置 NATS 连接
- [ ] 配置 MinIO 客户端
- [ ] 初始化数据库表 (使用 GORM AutoMigrate)
- [ ] 基础 Gin 路由注册
- [ ] 统一错误响应封装
- [ ] 日志初始化 (zap)
- [ ] 配置文件加载 (viper)

### 交付物
- 基础 API 服务可启动
- `GET /health` 健康检查

---

## MVP v0.2: 用户系统 (1周)

### 目标
完整的用户注册登录流程

### 任务清单
- [ ] 用户表模型与 CRUD
- [ ] 密码加密 (bcrypt)
- [ ] 验证码生成与验证 (captcha)
- [ ] 注册接口 + 限流
- [ ] 登录接口 + JWT 生成
- [ ] JWT 中间件
- [ ] Session 存储 Redis
- [ ] 用户信息获取/更新
- [ ] 修改密码
- [ ] 管理员角色权限

### 交付物
- 完整的用户认证流程
- API: `/user/register`, `/user/login`, `/user/info`

---

## MVP v0.3: 题库基础 (1周)

### 目标
题目管理 + 提交接口

### 任务清单
- [ ] 语言表模型 (Language Registry)
- [ ] 预置语言数据 (C++17/Python3/Go/Java)
- [ ] 题目表模型 + CRUD
- [ ] 题目列表 (分页/搜索/难度筛选)
- [ ] 题目详情 (Markdown 渲染)
- [ ] 提交接口 (返回 submit_id)
- [ ] 提交列表查询
- [ ] 提交详情查询
- [ ] 代码存储 MinIO

### 交付物
- API: `/problem/*`, `/submit/*`
- 代码可存储 MinIO

---

## MVP v0.4: 评测核心 (2周)

### 目标
评测系统核心功能

### 任务清单
- [ ] NATS JetStream 初始化
- [ ] Streams/Consumers 配置
- [ ] 任务消息格式定义
- [ ] Judge Worker 框架
- [ ] Goroutine Pool 并发控制
- [ ] 编译阶段实现
- [ ] 运行阶段实现
- [ ] 结果比对 (普通比对 + SPJ)
- [ ] 状态机更新
- [ ] 日志上传 MinIO
- [ ] 幂等处理
- [ ] 超时回收
- [ ] 重试/DLQ
- [ ] Docker Runner 基础

### 交付物
- 完整的
- 评测评测链路结果可回写

---

## MVP v0.5: 前端基础 (1周)

### 目标
基础前端页面

### 任务清单
- [ ] React + Vite + TS 项目初始化
- [ ] Ant Design 引入
- [ ] Monaco Editor 集成
- [ ] 登录/注册页面
- [ ] 题目列表页
- [ ] 题目详情页 (Markdown + KaTeX)
- [ ] 代码提交页
- [ ] 提交记录页
- [ ] 用户中心页

### 交付物
- 可用的前端页面
- 可完成基础做题流程

---

## MVP v0.6: 比赛基础 (1周)

### 目标
比赛系统基础功能

### 任务清单
- [ ] 比赛表模型
- [ ] 比赛 CRUD
- [ ] 比赛报名
- [ ] 比赛内提交
- [ ] ACM 榜单计算
- [ ] 封榜机制
- [ ] 比赛详情页
- [ ] 榜单展示页

### 交付物
- 完整的比赛流程
- API: `/contest/*`

---

## MVP v0.7: 实时推送 (1周)

### 目标
WebSocket 实时功能

### 任务清单
- [ ] WebSocket Hub 实现
- [ ] 订阅/发布机制
- [ ] 提交状态推送
- [ ] 比赛榜单推送
- [ ] 前端 WebSocket 集成
- [ ] 断线重连

### 交付物
- 实时提交状态
- 实时榜单更新

---

## MVP v0.8: CF同步 (1周)

### 目标
Codeforces 镜像赛

### 任务清单
- [ ] Codeforces API 封装
- [ ] 比赛同步 (创建本地比赛)
- [ ] 题目同步 (可选)
- [ ] 榜单同步
- [ ] 定时同步任务
- [ ] 虚拟参赛
- [ ] 练习模式

### 交付物
- CF 镜像赛功能

---

## MVP v1.0: 优化上线 (1周)

### 目标
性能优化与部署

### 任务清单
- [ ] 缓存优化
- [ ] 排行榜优化
- [ ] 限流优化
- [ ] 监控告警 (Prometheus)
- [ ] Docker Compose 部署
- [ ] CI/CD 基础
- [ ] 压力测试
- [ ] Bug 修复

### 交付物
- 可上线的完整系统

---

## 时间线总览

```
Week 1:  v0.1 核心骨架
Week 2:  v0.2 用户系统
Week 3:  v0.3 题库基础
Week 4:  v0.4 评测核心 (1)
Week 5:  v0.4 评测核心 (2)
Week 6:  v0.5 前端基础
Week 7:  v0.6 比赛基础
Week 8:  v0.7 实时推送
Week 9:  v0.8 CF同步
Week 10: v1.0 优化上线
```

**预计总周期: 10 周**

---

## 里程碑检查点

| 里程碑 | 验收标准 |
|--------|----------|
| v0.3 | 可创建题目、提交代码 |
| v0.4 | 代码提交后可自动评测并返回结果 |
| v0.5 | 完整做题流程 (前后端) |
| v0.6 | 可创建比赛并查看榜单 |
| v1.0 | 系统可部署并稳定运行 |
